%YAML 1.2
# SPDX-FileCopyrightText: Copyright (c) 2023 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
multithreaded: true
num_delay_ops: 32
delay: 0.1
delay_step: 0.01

scheduler:
  check_recession_period_ms: 0
  worker_thread_number: 8
  stop_on_deadlock: true
  stop_on_deadlock_timeout: 500

pipeline:
  subchannel_select0: false
  converter0: true
  rotator0: false
  resample0: false
  resample1: true
  resample2: true

rx_params:
  batch_size: &batch_size 1024  # Number of packets to process at once into tensor data
  max_packet_size: &max_packet_size 8256
  num_subchannels: &num_subchannels 1  # Number of IQ subchannels of data that form a sample
  num_samples: &rx_chunk_size 2560000  # Number of samples to output as a single chunk, must fit one batch of packets
  buffer_size: 10  # Number of num_samples chunks to store in the rx buffer

advanced_network:
  cfg:
    version: 1
    master_core: 1                 # Master CPU core
    rx:
      - if_name: 0004:01:00.0       # PCIe BFD of NIC
        flow_isolation: true
        queues:
          - name: "RF Samples Ch0"
            id: 0
            gpu_device: 0
            gpu_direct: true
            split_boundary: 42
            cpu_cores: "2"
            max_packet_size: *max_packet_size       # Maximum payload size
            num_concurrent_batches: 15  # Number of batches that can be used at any time
            batch_size: *batch_size            # Number of packets in a batch
            output_port: "ch0"
        flows:
          - name: "UDP 60133 - Ch0"
            action:
              type: queue
              id: 0
            match:
              udp_src: 60133
              udp_dst: 60133

SubchannelSelectOp:
  subchannel_idx: [0]

ScheduledRotatorOp0:
  cycle_duration_secs: 1
  cycle_start_timestamp: 0
  schedule:
    - start: 0
      freq: 0e+6


ResamplePolyOp1:
  chunk_size: *rx_chunk_size
  num_subchannels: *num_subchannels
  up: 1
  down: 4
  # scipy.signal.kaiserord(100, .2)
  # scipy.signal.firwin(63, 1/4, window=('kaiser', 10.06126))
  filter_coefs: [-2.432986354338939902e-06, -1.201387301755816774e-05, -2.010498573383628115e-05, 4.865785110597989198e-20, 7.234990153682062798e-05, 1.718833047653556192e-04, 1.936611739202120279e-04, -3.075496883998056510e-19, -4.371133391839054504e-04, -8.871516936482441804e-04, -8.784067619253728160e-04, 1.042633239824355963e-18, 1.619716840871448203e-03, 3.030881092474629977e-03, 2.794442692477808014e-03, -2.491560614216840016e-18, -4.576011787082063208e-03, -8.151611658702415109e-03, -7.198316142465801051e-03, 4.637485763314281690e-18, 1.100614435068092249e-02, 1.912193894312655060e-02, 1.658519934592679254e-02, -7.054821738079720252e-18, -2.513162444027867287e-02, -4.429275629171359335e-02, -3.972771271168364093e-02, 8.997958484987521336e-18, 7.173841174691804323e-02, 1.560196258815701176e-01, 2.239619030958457935e-01, 2.499981966033499314e-01, 2.239619030958457935e-01, 1.560196258815701176e-01, 7.173841174691804323e-02, 8.997958484987521336e-18, -3.972771271168364093e-02, -4.429275629171359335e-02, -2.513162444027867287e-02, -7.054821738079720252e-18, 1.658519934592679254e-02, 1.912193894312655060e-02, 1.100614435068092249e-02, 4.637485763314281690e-18, -7.198316142465801051e-03, -8.151611658702415109e-03, -4.576011787082063208e-03, -2.491560614216840016e-18, 2.794442692477808014e-03, 3.030881092474629977e-03, 1.619716840871448203e-03, 1.042633239824355963e-18, -8.784067619253728160e-04, -8.871516936482441804e-04, -4.371133391839054504e-04, -3.075496883998056510e-19, 1.936611739202120279e-04, 1.718833047653556192e-04, 7.234990153682062798e-05, 4.865785110597989198e-20, -2.010498573383628115e-05, -1.201387301755816774e-05, -2.432986354338939902e-06]

ResamplePolyOp2:
  chunk_size: 640000
  num_subchannels: *num_subchannels
  up: 5
  down: 8
  # scipy.signal.kaiserord(81, .1 / 5)
  # scipy.signal.firwin(511, 5/8/5, window=('kaiser', 7.96746))
  filter_coefs: [-1.151777320409346486e-06, -2.410365982346206387e-06, -3.541860246312996381e-06, -4.285489979918370967e-06, -4.402510245650196455e-06, -3.729289036059189453e-06, -2.224497055135273337e-06, 4.690944794545622982e-20, 2.673232835526349532e-06, 5.389239566018897897e-06, 7.661110202119294176e-06, 8.999088754559731677e-06, 9.001427115640296041e-06, 7.442694916088430764e-06, 4.342633904324942058e-06, -1.316298000754213852e-19, -5.019730796002936550e-06, -9.946858753910002424e-06, -1.391553594233575470e-05, -1.610388490551233537e-05, -1.588509586560040183e-05, -1.296382850621767491e-05, -7.471727853239501210e-06, -2.571033864770361985e-23, 8.444437446009253501e-06, 1.656075509626100438e-05, 2.294189706188981735e-05, 2.630310844380171417e-05, 2.571626096857870268e-05, 2.080999543017773585e-05, 1.189723099827847499e-05, -1.125210348104046167e-19, -1.324390642227886882e-05, -2.578925846647040784e-05, -3.548333365724213369e-05, -4.041600437174279589e-05, -3.926564538005900988e-05, -3.158174614617266073e-05, -1.794996947208382269e-05, 3.376776744843442944e-19, 1.976070042211936940e-05, 3.827629096738980767e-05, 5.239556696547140662e-05, 5.938447950107657986e-05, 5.741803504566460385e-05, 4.596749256455344418e-05, 2.600862183611419223e-05, 2.784900294661938198e-19, -2.838583501785656678e-05, -5.475585630972936243e-05, -7.465273628319790645e-05, -8.427939555299564212e-05, -8.117807639796281326e-05, -6.474793770251961776e-05, -3.650211525240826114e-05, -4.877608192159657838e-20, 3.956118213376116693e-05, 7.605649717147254800e-05, 1.033532530751992768e-04, 1.163069486402660256e-04, 1.116762199900531578e-04, 8.880067089173852932e-05, 4.991214196043028086e-05, -3.979939586140704602e-19, -5.378206040196386787e-05, -1.031061643541549043e-04, -1.397262845351551319e-04, -1.568158340946438939e-04, -1.501754906690369270e-04, -1.191054767286703667e-04, -6.677610809878878968e-05, 1.151035917480003257e-18, 7.160035679386367888e-05, 1.369381655863651989e-04, 1.851397817981561785e-04, 2.073062350264144376e-04, 1.980800893801574916e-04, 1.567511633247088774e-04, 8.769097120323318748e-05, -2.320632274601743070e-18, -9.362867890294666959e-05, -1.786991587380140710e-04, -2.411113703561426343e-04, -2.694421248344277880e-04, -2.569472649267565221e-04, -2.029450596620450010e-04, -1.133186162029706223e-04, -2.996290128201087007e-19, 1.205462461844182770e-04, 2.296605555919437286e-04, 3.093239656966776459e-04, 3.450689882206827721e-04, 3.285044848168852845e-04, 2.590268027445823238e-04, 1.443936852253822521e-04, -9.517319813238466115e-19, -1.531075169537246560e-04, -2.912352583633881779e-04, -3.916487353232293096e-04, -4.362399219636036557e-04, -4.146747609911674549e-04, -3.264886963423818092e-04, -1.817351505380805437e-04, 2.871344865048032551e-18, 1.921549572086816927e-04, 3.650024427325877460e-04, 4.901791113966738785e-04, 5.452543049335764440e-04, 5.176141756153958230e-04, 4.070058777213584819e-04, 2.262634619505137694e-04, -1.338605175577796860e-18, -2.386379546841888662e-04, -4.527442606812425298e-04, -6.072811505109545994e-04, -6.747150390343340269e-04, -6.397674133765343532e-04, -5.024809474471035467e-04, -2.790259084212346309e-04, -1.100211979529973984e-18, 2.936407790185832168e-04, 5.565000848669700339e-04, 7.456679468301796775e-04, 8.276131152790217266e-04, 7.839497916041305919e-04, 6.151098879114449665e-04, 3.412340749869079517e-04, -1.790769835785772558e-18, -3.584238770943306705e-04, -6.786466306078698307e-04, -9.085095594329213728e-04, -1.007452563707789909e-03, -9.534684936998188325e-04, -7.474795156778477577e-04, -4.143192389858408979e-04, 5.975836293833814085e-18, 4.344850039620261535e-04, 8.220166315962968134e-04, 1.099595940641422695e-03, 1.218435780379688521e-03, 1.152302526106735014e-03, 9.027122634531299303e-04, 5.000147480420487822e-04, -2.292595817615455456e-18, -5.236503211717573368e-04, -9.900759005225371646e-04, -1.323580325818692538e-03, -1.465740747970912519e-03, -1.385372288856010674e-03, -1.084683385955957863e-03, -6.004798023032157338e-04, -3.146876108603765758e-18, 6.282117535194165067e-04, 1.187190792716622239e-03, 1.586347605624871321e-03, 1.755941463032659969e-03, 1.658949268175522428e-03, 1.298351799547240804e-03, 7.184884297297920979e-04, -2.821170306558477627e-18, -7.511377166166548257e-04, -1.419039603111850152e-03, -1.895582459847499528e-03, -2.097658162986033598e-03, -1.981291493537820463e-03, -1.550274769788398095e-03, -8.577243855482803974e-04, 1.122711946130555433e-17, 8.964041052148070867e-04, 1.693260951755475464e-03, 2.261667925930392446e-03, 2.502589474336269423e-03, 2.363656023035797232e-03, 1.849431142064047280e-03, 1.023254715263970799e-03, -3.347760640074436806e-18, -1.069530243022109991e-03, -2.020508239702658183e-03, -2.699153258920995897e-03, -2.987206241590372770e-03, -2.821968369677639848e-03, -2.208585325434500850e-03, -1.222318313750134396e-03, 3.600302328218129558e-18, 1.278480666425019577e-03, 2.416233517251746045e-03, 3.229251058888122066e-03, 3.575649636478566221e-03, 3.379695734274669114e-03, 2.646649088721621246e-03, 1.465699873269724540e-03, -3.840152204181284217e-18, -1.535256868075829352e-03, -2.903857562926364082e-03, -3.884305830806421278e-03, -4.304954482052316192e-03, -4.073063720940948464e-03, -3.193002266713382623e-03, -1.770263051134716471e-03, 4.063228242942215319e-18, 1.858880135216312360e-03, 3.520761116872149401e-03, 4.716313489231899539e-03, 5.235097955879672478e-03, 4.961186048745901654e-03, 3.895963423549845487e-03, 2.163966046476480890e-03, -4.265621235251102800e-18, -2.281421229333598175e-03, -4.330528433930952957e-03, -5.814528572062924172e-03, -6.470010154652597149e-03, -6.147500917325881241e-03, -4.840940080948812063e-03, -2.696748152780463308e-03, 4.443697045675745539e-18, 2.861449702154232177e-03, 5.450653004447209710e-03, 7.345908030582134866e-03, 8.206592179356247269e-03, 7.830598852633980159e-03, 6.194196741528238889e-03, 3.467247602287003815e-03, -4.594193578610609236e-18, -3.718303357345059852e-03, -7.124563007695286672e-03, -9.662482879348337217e-03, -1.086774904372174444e-02, -1.044539476218665427e-02, -8.327411665502834973e-03, -4.700809534322320134e-03, 4.714309212663745811e-18, 5.137866891839845511e-03, 9.950773666794072644e-03, 1.365412291439080730e-02, 1.555466868469984089e-02, 1.516091202613963247e-02, 1.227435732323510151e-02, 7.047735335091957938e-03, -4.801779711556089836e-18, -8.016822400179420688e-03, -1.589766450557670088e-02, -2.240375901637286712e-02, -2.630814684702204032e-02, -2.655014284265952776e-02, -2.237958450316930928e-02, -1.347215666327909733e-02, 4.854940983994765160e-18, 1.735313745208290695e-02, 3.743636119407073304e-02, 5.873255825545664610e-02, 7.950556079170224832e-02, 9.797736103774605521e-02, 1.125151596364332290e-01, 1.218064609809443311e-01, 1.250015582137692649e-01, 1.218064609809443311e-01, 1.125151596364332290e-01, 9.797736103774605521e-02, 7.950556079170224832e-02, 5.873255825545664610e-02, 3.743636119407073304e-02, 1.735313745208290695e-02, 4.854940983994765160e-18, -1.347215666327909733e-02, -2.237958450316930928e-02, -2.655014284265952776e-02, -2.630814684702204032e-02, -2.240375901637286712e-02, -1.589766450557670088e-02, -8.016822400179420688e-03, -4.801779711556089836e-18, 7.047735335091957938e-03, 1.227435732323510151e-02, 1.516091202613963247e-02, 1.555466868469984089e-02, 1.365412291439080730e-02, 9.950773666794072644e-03, 5.137866891839845511e-03, 4.714309212663745811e-18, -4.700809534322320134e-03, -8.327411665502834973e-03, -1.044539476218665427e-02, -1.086774904372174444e-02, -9.662482879348337217e-03, -7.124563007695286672e-03, -3.718303357345059852e-03, -4.594193578610609236e-18, 3.467247602287003815e-03, 6.194196741528238889e-03, 7.830598852633980159e-03, 8.206592179356247269e-03, 7.345908030582134866e-03, 5.450653004447209710e-03, 2.861449702154232177e-03, 4.443697045675745539e-18, -2.696748152780463308e-03, -4.840940080948812063e-03, -6.147500917325881241e-03, -6.470010154652597149e-03, -5.814528572062924172e-03, -4.330528433930952957e-03, -2.281421229333598175e-03, -4.265621235251102800e-18, 2.163966046476480890e-03, 3.895963423549845487e-03, 4.961186048745901654e-03, 5.235097955879672478e-03, 4.716313489231899539e-03, 3.520761116872149401e-03, 1.858880135216312360e-03, 4.063228242942215319e-18, -1.770263051134716471e-03, -3.193002266713382623e-03, -4.073063720940948464e-03, -4.304954482052316192e-03, -3.884305830806421278e-03, -2.903857562926364082e-03, -1.535256868075829352e-03, -3.840152204181284217e-18, 1.465699873269724540e-03, 2.646649088721621246e-03, 3.379695734274669114e-03, 3.575649636478566221e-03, 3.229251058888122066e-03, 2.416233517251746045e-03, 1.278480666425019577e-03, 3.600302328218129558e-18, -1.222318313750134396e-03, -2.208585325434500850e-03, -2.821968369677639848e-03, -2.987206241590372770e-03, -2.699153258920995897e-03, -2.020508239702658183e-03, -1.069530243022109991e-03, -3.347760640074436806e-18, 1.023254715263970799e-03, 1.849431142064047280e-03, 2.363656023035797232e-03, 2.502589474336269423e-03, 2.261667925930392446e-03, 1.693260951755475464e-03, 8.964041052148070867e-04, 1.122711946130555433e-17, -8.577243855482803974e-04, -1.550274769788398095e-03, -1.981291493537820463e-03, -2.097658162986033598e-03, -1.895582459847499528e-03, -1.419039603111850152e-03, -7.511377166166548257e-04, -2.821170306558477627e-18, 7.184884297297920979e-04, 1.298351799547240804e-03, 1.658949268175522428e-03, 1.755941463032659969e-03, 1.586347605624871321e-03, 1.187190792716622239e-03, 6.282117535194165067e-04, -3.146876108603765758e-18, -6.004798023032157338e-04, -1.084683385955957863e-03, -1.385372288856010674e-03, -1.465740747970912519e-03, -1.323580325818692538e-03, -9.900759005225371646e-04, -5.236503211717573368e-04, -2.292595817615455456e-18, 5.000147480420487822e-04, 9.027122634531299303e-04, 1.152302526106735014e-03, 1.218435780379688521e-03, 1.099595940641422695e-03, 8.220166315962968134e-04, 4.344850039620261535e-04, 5.975836293833814085e-18, -4.143192389858408979e-04, -7.474795156778477577e-04, -9.534684936998188325e-04, -1.007452563707789909e-03, -9.085095594329213728e-04, -6.786466306078698307e-04, -3.584238770943306705e-04, -1.790769835785772558e-18, 3.412340749869079517e-04, 6.151098879114449665e-04, 7.839497916041305919e-04, 8.276131152790217266e-04, 7.456679468301796775e-04, 5.565000848669700339e-04, 2.936407790185832168e-04, -1.100211979529973984e-18, -2.790259084212346309e-04, -5.024809474471035467e-04, -6.397674133765343532e-04, -6.747150390343340269e-04, -6.072811505109545994e-04, -4.527442606812425298e-04, -2.386379546841888662e-04, -1.338605175577796860e-18, 2.262634619505137694e-04, 4.070058777213584819e-04, 5.176141756153958230e-04, 5.452543049335764440e-04, 4.901791113966738785e-04, 3.650024427325877460e-04, 1.921549572086816927e-04, 2.871344865048032551e-18, -1.817351505380805437e-04, -3.264886963423818092e-04, -4.146747609911674549e-04, -4.362399219636036557e-04, -3.916487353232293096e-04, -2.912352583633881779e-04, -1.531075169537246560e-04, -9.517319813238466115e-19, 1.443936852253822521e-04, 2.590268027445823238e-04, 3.285044848168852845e-04, 3.450689882206827721e-04, 3.093239656966776459e-04, 2.296605555919437286e-04, 1.205462461844182770e-04, -2.996290128201087007e-19, -1.133186162029706223e-04, -2.029450596620450010e-04, -2.569472649267565221e-04, -2.694421248344277880e-04, -2.411113703561426343e-04, -1.786991587380140710e-04, -9.362867890294666959e-05, -2.320632274601743070e-18, 8.769097120323318748e-05, 1.567511633247088774e-04, 1.980800893801574916e-04, 2.073062350264144376e-04, 1.851397817981561785e-04, 1.369381655863651989e-04, 7.160035679386367888e-05, 1.151035917480003257e-18, -6.677610809878878968e-05, -1.191054767286703667e-04, -1.501754906690369270e-04, -1.568158340946438939e-04, -1.397262845351551319e-04, -1.031061643541549043e-04, -5.378206040196386787e-05, -3.979939586140704602e-19, 4.991214196043028086e-05, 8.880067089173852932e-05, 1.116762199900531578e-04, 1.163069486402660256e-04, 1.033532530751992768e-04, 7.605649717147254800e-05, 3.956118213376116693e-05, -4.877608192159657838e-20, -3.650211525240826114e-05, -6.474793770251961776e-05, -8.117807639796281326e-05, -8.427939555299564212e-05, -7.465273628319790645e-05, -5.475585630972936243e-05, -2.838583501785656678e-05, 2.784900294661938198e-19, 2.600862183611419223e-05, 4.596749256455344418e-05, 5.741803504566460385e-05, 5.938447950107657986e-05, 5.239556696547140662e-05, 3.827629096738980767e-05, 1.976070042211936940e-05, 3.376776744843442944e-19, -1.794996947208382269e-05, -3.158174614617266073e-05, -3.926564538005900988e-05, -4.041600437174279589e-05, -3.548333365724213369e-05, -2.578925846647040784e-05, -1.324390642227886882e-05, -1.125210348104046167e-19, 1.189723099827847499e-05, 2.080999543017773585e-05, 2.571626096857870268e-05, 2.630310844380171417e-05, 2.294189706188981735e-05, 1.656075509626100438e-05, 8.444437446009253501e-06, -2.571033864770361985e-23, -7.471727853239501210e-06, -1.296382850621767491e-05, -1.588509586560040183e-05, -1.610388490551233537e-05, -1.391553594233575470e-05, -9.946858753910002424e-06, -5.019730796002936550e-06, -1.316298000754213852e-19, 4.342633904324942058e-06, 7.442694916088430764e-06, 9.001427115640296041e-06, 8.999088754559731677e-06, 7.661110202119294176e-06, 5.389239566018897897e-06, 2.673232835526349532e-06, 4.690944794545622982e-20, -2.224497055135273337e-06, -3.729289036059189453e-06, -4.402510245650196455e-06, -4.285489979918370967e-06, -3.541860246312996381e-06, -2.410365982346206387e-06, -1.151777320409346486e-06]

DigitalRFSinkOp0:
  chunk_size: &drf_chunk_size 400000
  num_subchannels: *num_subchannels
  channel_dir: /data/ringbuffer/mep/sr10MHz
  uuid: mep_pipeline_sr10MHz
